KoM_use_alchemical_consumable_interaction = {
	category = interaction_category_friendly
	icon = artifact
	desc = KoM_use_alchemical_consumable_interaction_desc

	target_type = artifact
	target_filter = actor_artifacts

	ai_frequency = 0

	is_shown = {
		scope:actor = scope:recipient
		scope:actor = {
			any_character_artifact = {
				has_variable = KoM_potion
			}
		}
	}

	can_be_picked_artifact = {
		scope:target = {
			custom_tooltip = {
				text = KoM_use_alchemical_consumable_interaction_tt
				has_variable = KoM_potion
			}
		}
	}

	on_accept = {
		scope:actor = {
			KoM_consume_potion_effect = { POTION = scope:target }
		}
	}
}

KoM_offer_alchemical_consumable_interaction = {
	category = interaction_category_friendly
	icon = artifact
	desc = KoM_offer_alchemical_consumable_interaction_desc

	common_interaction = yes

	target_type = artifact
	target_filter = actor_artifacts

	is_shown = {
		NOT = { scope:actor = scope:recipient }
		scope:actor = {
			any_character_artifact = {
				has_variable = KoM_potion
			}
		}
	}

	can_be_picked_artifact = {
		scope:target = {
			custom_tooltip = {
				text = KoM_use_alchemical_consumable_interaction_tt
				has_variable = KoM_potion
			}
		}
	}

	on_accept = {
		scope:recipient = {
			KoM_consume_potion_effect = { POTION = scope:target }
		}
	}

	ai_accept = {
		base = -25
		opinion_modifier = { # More likely to accept if Recipient likes the Actor
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 0.3
			min = 0
			desc = AI_OPINION_REASON
		}
		opinion_modifier = { # Less likely to accept if Recipient dislikes the Actor
			who = scope:recipient
			opinion_target = scope:actor
			multiplier = 1
			max = 0
			desc = AI_OPINION_REASON
		}
		modifier = { # Say no to rivals
			add = -100
			scope:recipient = {
				has_relation_rival = scope:actor
				NOT = { has_relation_nemesis = scope:actor }
			}
			desc = "ACTOR_RIVAL_TO_ME_REASON"
		}
		modifier = { # Say no to nemesis
			add = -300
			scope:recipient = {
				has_relation_nemesis = scope:actor
			}
			desc = "ACTOR_NEMESIS_TO_ME_REASON"
		}
	}

	ai_potential = {
		# The basic requirements
		is_imprisoned = no
		is_landed = yes
	}
	ai_targets = {
		ai_recipients = self
	}
	ai_frequency = 18
	ai_will_do = {
		base = 20
	}
}

KoM_alchemy_interaction = {
	category = interaction_category_religion
	icon = KoM_alchemy_interaction
	desc = KoM_alchemy_interaction_desc

	use_diplomatic_range = no

	is_shown = {
		scope:actor = { KoM_is_practitioner_of_magic_school_trigger = { SCHOOL = flag:alchemy } }
	}
	is_valid_showing_failures_only = {
		scope:actor = { KoM_must_self_cast_trigger = yes }
	}

	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 10 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 1 }
			}
		}
		flag = elixir_of_the_white_rose
		localization = KoM_rite_elixir_of_the_white_rose
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 10 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = charcoal COUNT = 1 }
			}
		}
		flag = draught_of_still_waters
		localization = KoM_rite_draught_of_still_waters
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 10 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = lead COUNT = 2 }
			}
		}
		flag = infusion_of_lead
		localization = KoM_rite_infusion_of_lead
	}

	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 30 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = salt COUNT = 1 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = vulcanic_ash COUNT = 1 }
			}
		}
		flag = elixir_of_ash_and_salt
		localization = KoM_rite_elixir_of_ash_and_salt
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 30 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = silver COUNT = 2 }
			}
		}
		flag = dew_of_morning_stars
		localization = KoM_rite_dew_of_morning_stars
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 30 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = silver COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = crushed_crystals COUNT = 1 }
			}
		}
		flag = aqua_sapientiae
		localization = KoM_rite_aqua_sapientiae
	}

	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 50 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = salt COUNT = 3 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 2 }
			}
		}
		flag = elixir_of_the_solar_mind
		localization = KoM_rite_elixir_of_the_solar_mind
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 50 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = charcoal COUNT = 3 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 3 }
			}
		}
		flag = draught_of_the_inner_flame
		localization = KoM_rite_draught_of_the_inner_flame
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 50 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = human_blood COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = silver COUNT = 3 }
			}
		}
		flag = tears_of_the_red_king
		localization = KoM_rite_tears_of_the_red_king
	}

	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 75 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = human_blood COUNT = 3 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = crushed_crystals COUNT = 2 }
			}
		}
		flag = blood_of_the_phoenix
		localization = KoM_rite_blood_of_the_phoenix
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 75 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = crushed_crystals COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 4 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = fireflower COUNT = 1 }
			}
		}
		flag = elixir_rubedo
		localization = KoM_rite_elixir_rubedo
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 75 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = human_blood COUNT = 3 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = fireflower COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = lead COUNT = 4 }
			}
		}
		flag = homunculi
		localization = KoM_rite_homunculi
	}

	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 100 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = human_blood COUNT = 3 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = fireflower COUNT = 2 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 4 }
			}
		}
		flag = elixir_vitae
		localization = KoM_rite_elixir_vitae
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 100 AT_LEAST = yes }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = honey COUNT = 4 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = silver COUNT = 4 }
				KoM_has_above_alchemic_material_trigger = { MATERIAL = vulcanic_ash COUNT = 2 }
			}
		}
		flag = aurum_astralis
		localization = KoM_rite_aurum_astralis
	}
	send_option = {
		is_valid = {
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = flag:alchemy VALUE = 100 AT_LEAST = yes }
				KoM_has_alchemic_potion_trigger = { POTION = elixir_of_the_white_rose }
				KoM_has_alchemic_potion_trigger = { POTION = draught_of_still_waters }
				KoM_has_alchemic_potion_trigger = { POTION = infusion_of_lead }
				KoM_has_alchemic_potion_trigger = { POTION = elixir_of_ash_and_salt }
				KoM_has_alchemic_potion_trigger = { POTION = dew_of_morning_stars }
				KoM_has_alchemic_potion_trigger = { POTION = aqua_sapientiae }
				KoM_has_alchemic_potion_trigger = { POTION = elixir_of_the_solar_mind }
				KoM_has_alchemic_potion_trigger = { POTION = draught_of_the_inner_flame }
				KoM_has_alchemic_potion_trigger = { POTION = tears_of_the_red_king }
				KoM_has_alchemic_potion_trigger = { POTION = blood_of_the_phoenix }
				KoM_has_alchemic_potion_trigger = { POTION = elixir_rubedo }
				KoM_has_alchemic_potion_trigger = { POTION = homunculi }
				KoM_has_alchemic_potion_trigger = { POTION = elixir_vitae }
				KoM_has_alchemic_potion_trigger = { POTION = aurum_astralis }
			}
		}
		flag = the_philosophers_stone
		localization = KoM_rite_the_philosophers_stone
	}

	on_accept = {
		scope:actor = {
			switch = {
				trigger = yes
				scope:elixir_of_the_white_rose = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -1 }
					KoM_start_rite_effect = {
						ID = elixir_of_the_white_rose
						MONTHLY_PROGRESS = KoM_rite_time_1_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_elixir_of_the_white_rose_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_elixir_of_the_white_rose_potion_effect = yes }
				}
				scope:draught_of_still_waters = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_charcoal COUNT = -1 }
					KoM_start_rite_effect = {
						ID = draught_of_still_waters
						MONTHLY_PROGRESS = KoM_rite_time_1_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_draught_of_still_waters_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_draught_of_still_waters_potion_effect = yes }
				}
				scope:infusion_of_lead = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_lead COUNT = -2 }
					KoM_start_rite_effect = {
						ID = infusion_of_lead
						MONTHLY_PROGRESS = KoM_rite_time_1_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_infusion_of_lead_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_infusion_of_lead_potion_effect = yes }
				}

				scope:elixir_of_ash_and_salt = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_salt COUNT = -1 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_vulcanic_ash COUNT = -1 }
					KoM_start_rite_effect = {
						ID = elixir_of_ash_and_salt
						MONTHLY_PROGRESS = KoM_rite_time_3_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_elixir_of_ash_and_salt_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_elixir_of_ash_and_salt_potion_effect = yes }
				}
				scope:dew_of_morning_stars = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_silver COUNT = -1 }
					KoM_start_rite_effect = {
						ID = dew_of_morning_stars
						MONTHLY_PROGRESS = KoM_rite_time_3_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_dew_of_morning_stars_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_dew_of_morning_stars_potion_effect = yes }
				}
				scope:aqua_sapientiae = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_silver COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_crushed_crystals COUNT = -1 }
					KoM_start_rite_effect = {
						ID = aqua_sapientiae
						MONTHLY_PROGRESS = KoM_rite_time_3_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_aqua_sapientiae_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_aqua_sapientiae_potion_effect = yes }
				}

				scope:elixir_of_the_solar_mind = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_salt COUNT = -3 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -2 }
					KoM_start_rite_effect = {
						ID = elixir_of_the_solar_mind
						MONTHLY_PROGRESS = KoM_rite_time_6_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_elixir_of_the_solar_mind_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_elixir_of_the_solar_mind_potion_effect = yes }
				}
				scope:draught_of_the_inner_flame = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_charcoal COUNT = -3 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -3 }
					KoM_start_rite_effect = {
						ID = draught_of_the_inner_flame
						MONTHLY_PROGRESS = KoM_rite_time_6_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_draught_of_the_inner_flame_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_draught_of_the_inner_flame_potion_effect = yes }
				}
				scope:tears_of_the_red_king = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_human_blood COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_silver COUNT = -3 }
					KoM_start_rite_effect = {
						ID = tears_of_the_red_king
						MONTHLY_PROGRESS = KoM_rite_time_6_months
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_tears_of_the_red_king_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_tears_of_the_red_king_potion_effect = yes }
				}

				scope:blood_of_the_phoenix = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_human_blood COUNT = -3 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_crushed_crystals COUNT = -2 }
					KoM_start_rite_effect = {
						ID = blood_of_the_phoenix
						MONTHLY_PROGRESS = KoM_rite_time_1_year
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_blood_of_the_phoenix_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_blood_of_the_phoenix_potion_effect = yes }
				}
				scope:elixir_rubedo = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_crushed_crystals COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -4 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_fireflower COUNT = -1 }
					KoM_start_rite_effect = {
						ID = elixir_rubedo
						MONTHLY_PROGRESS = KoM_rite_time_1_year
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_elixir_rubedo_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_elixir_rubedo_potion_effect = yes }
				}
				scope:homunculi = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_human_blood COUNT = -3 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_fireflower COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_lead COUNT = -4 }
					KoM_start_rite_effect = {
						ID = homunculi
						MONTHLY_PROGRESS = KoM_rite_time_1_year
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_homunculi_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_homunculi_potion_effect = yes }
				}

				scope:elixir_vitae = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_human_blood COUNT = -3 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_fireflower COUNT = -2 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -4 }
					KoM_start_rite_effect = {
						ID = elixir_vitae
						MONTHLY_PROGRESS = KoM_rite_time_2_years
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_elixir_vitae_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_elixir_vitae_potion_effect = yes }
				}
				scope:aurum_astralis = {
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_honey COUNT = -4 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_silver COUNT = -4 }
					KoM_change_alchemical_material_effect = { MATERIAL = KoM_alchemy_vulcanic_ash COUNT = -2 }
					KoM_start_rite_effect = {
						ID = aurum_astralis
						MONTHLY_PROGRESS = KoM_rite_time_2_years
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_aurum_astralis_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_aurum_astralis_potion_effect = yes }
				}
				scope:the_philosophers_stone = {
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_elixir_of_the_white_rose } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_draught_of_still_waters } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_infusion_of_lead } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_elixir_of_ash_and_salt } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_dew_of_morning_stars } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_aqua_sapientiae } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_elixir_of_the_solar_mind } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_draught_of_the_inner_flame } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_tears_of_the_red_king } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_blood_of_the_phoenix } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_elixir_rubedo } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_homunculi } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_elixir_vitae } destroy_artifact = this }
					random_character_artifact = { limit = { var:KoM_potion ?= flag:KoM_aurum_astralis } destroy_artifact = this }
					KoM_start_rite_effect = {
						ID = the_philosophers_stone
						MONTHLY_PROGRESS = KoM_rite_time_2_years
						TARGET = scope:recipient
						SCHOOL = alchemy
					}
					custom_tooltip = KoM_rite_showcase
					show_as_tooltip = { KoM_the_philosophers_stone_effect = yes }
					custom_tooltip = KoM_potion_showcase
					show_as_tooltip = { KoM_the_philosophers_stone_potion_effect = yes }
				}
			}
		}
	}
}
KoM_study_grimoire_interaction = {
	category = interaction_category_friendly
	icon = icon_scheme_crypto_religion
	desc = KoM_study_grimoire_interaction_desc

	target_type = artifact
	target_filter = actor_artifacts

	# cooldown = { years = 1 }

	is_shown = {
		scope:actor = scope:recipient
		scope:actor = {
			any_character_artifact = {
				has_variable = KoM_grimoire
			}
		}
	}

	can_be_picked_artifact = {
		scope:target = {
			custom_tooltip = {
				text = KoM_study_grimoire_interaction_tt
				has_variable = KoM_grimoire
			}
		}
	}

	is_valid_showing_failures_only = {
		trigger_if = {
			limit = { exists = scope:target scope:target ?= { has_variable = KoM_grimoire } }
			scope:actor = {
				KoM_has_magic_school_xp_trigger = { SCHOOL = scope:target.var:KoM_grimoire VALUE = scope:target.var:max_mastery AT_LEAST = no } 
				KoM_has_magic_school_xp_trigger = { SCHOOL = scope:target.var:KoM_grimoire VALUE = scope:target.var:min_mastery AT_LEAST = yes }
			}
		}
	}

	on_accept = {
		scope:actor = {
			duel = {
				skill = learning
				value = 10
				50 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = high_positive_duel_skill_multiplier
					}
					KoM_study_magic_school_effect = { SCHOOL = scope:target.var:KoM_grimoire COUNT = scope:target.var:mastery_gain }
				}
				50 = {
					compare_modifier = {
						value = scope:duel_value
						multiplier = low_negative_duel_skill_multiplier
					}
					add_stress = 25
				}
			}
		}
	}

	auto_accept = yes
}
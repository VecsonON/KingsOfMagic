KoM_secret_magus = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_magus } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_magus POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_magus }
			add_trait_xp = {
				trait = KoM_magus
				value = KoM_goetia_xp
			}
			remove_variable = KoM_goetia_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_magus } }
		}
	}
}
KoM_secret_thaumaturge = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_thaumaturge } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_thaumaturge POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_thaumaturge }
			add_trait_xp = {
				trait = KoM_thaumaturge
				value = var:KoM_thaumaturgy_xp
			}
			remove_variable = KoM_thaumaturgy_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_thaumaturge } }
		}
	}
}
KoM_secret_theurgist = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_theurgist } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_theurgist POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_theurgist }
			add_trait_xp = {
				trait = KoM_theurgist
				value = var:KoM_theurgy_xp
			}
			remove_variable = KoM_theurgy_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_theurgist } }
		}
	}
}
KoM_secret_alchemist = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_alchemist } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_alchemist POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_alchemist }
			add_trait_xp = {
				trait = KoM_alchemist
				value = var:KoM_alchemy_xp
			}
			remove_variable = KoM_alchemy_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_alchemist } }
		}
	}
}
KoM_secret_daoshi = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_daoshi } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_daoshi POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_daoshi }
			add_trait_xp = {
				trait = KoM_daoshi
				value = var:KoM_taoism_xp
			}
			remove_variable = KoM_taoism_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_daoshi } }
		}
	}
}
KoM_secret_onmyoji = {
	category = religious

	is_valid = {
		scope:secret_owner = { NOT = { has_trait = KoM_onmyoji } }
	}

	is_shunned = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_shunned }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_shunned } }
			}
		}
	}

	is_criminal = {
		scope:secret_owner = {
			OR = {
				faith = { has_doctrine_parameter = witchcraft_illegal }
				any_liege_or_above = { faith = { has_doctrine_parameter = witchcraft_illegal } }
			}
		}
	}

	on_expose = {
		save_scope_as = secret

		secret_exposed_notification_effect = yes

		# Actual effects of exposing the secret
		scope:secret_owner = {
			secret_exposed_owner_effects_effect = { SECRET = scope:secret POV = scope:secret_exposer }
			add_trait_only_force_tooltip_if_not_pov_effect = { TRAIT = KoM_onmyoji POV = scope:secret_exposer }
			remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = KoM_onmyoji }
			add_trait_xp = {
				trait = KoM_onmyoji
				value = var:KoM_onmyodo_xp
			}
			remove_variable = KoM_onmyodo_xp
			if = { limit = { scope:shunned_trait_check ?= flag:KoM_onmyoji } }
		}
	}
}